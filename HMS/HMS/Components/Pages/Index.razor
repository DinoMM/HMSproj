@page "/"
@using DBLayer
@using HMS.ViewModels
@* @using Microsoft.AspNetCore.Identity *@
@* @using Microsoft.AspNetCore.Components.Authorization *@
@using System.Diagnostics
@* @using System.Security.Claims; *@


@inherits LayoutComponentBase
@inject IndexViewModel ViewModel

@inject Navigator Navigator
@inject Routes.LayoutService layoutService
@inject DbInitializeService initDB
@inject UserService UserService
@inject HMS.Components.Services.IAppLifeCycleService AppLifecycleService

@implements IDisposable
@*bez scrolovania style*@
<style>
    body {
        height: 100%;
        overflow: hidden;
    }
</style>

@*<InfoModal @ref="ViewModel.CloseAppModal" Text="Chcete ukončiť aplikáciu?"></InfoModal>*@

@if (UserService.LoggedUser != null)
{
    <div class="">
        <label>Prihlásený: @UserService.LoggedUser?.UserName </label>
        <div class="d-flex justify-content-center align-items-center vh-100">
            <div class="p-3 w-50 ">
                <div class="list-group text-center border border-2 border-black ">

                    @foreach (var item in ViewModel.ModulesList)
                    {
                        if (item.Item3.Contains(UserService.LoggedUserRole))
                        {
                            <a @onclick="@(() => Navigator.NavigateTo(item.Item2, saveThisUrl: true))" class="list-group-item list-group-item-action">@item.Item1</a>
                        }
                    }
                </div>
            </div>
            @*<button @onclick="ViewModel.OpenInfoModalCommand.Execute">Pridaj</button>*@
        </div>
    </div>
}
else
{
    <div class="d-flex justify-content-center align-items-center vh-100">
        <SpinnerLoading Size="3" />
    </div>
}




@code {

    protected override async Task OnInitializedAsync()
    {
        await initDB.TryMustHaveValues();

#if DEBUG

        //if (UserService.LoggedUser == null)
        //{
        //    await UserService.LogInUserAsync("admin", "Heslo123");
        //}

#endif
        if (UserService.LoggedUser == null)
        {
            Navigator.NavigateTo("/Login");
            return;
        }
    }

    public void Dispose()
    {
        
    }


}